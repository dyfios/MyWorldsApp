<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="transparent" content="true">
    <meta
      name="description"
      content="MyWorlds Client UI"
    />
    <title>MyWorlds Client UI</title>
    <!-- Vuplex Polyfill for cross-origin iframes in WebGL - MUST run before other scripts -->
    <script>
      class VuplexPolyfill {
        constructor() {
          this._listeners = {};
          window.addEventListener('message', this._handleWindowMessage.bind(this));
        }
        addEventListener(eventName, listener) {
          if (!this._listeners[eventName]) {
            this._listeners[eventName] = [];
          }
          if (this._listeners[eventName].indexOf(listener) === -1) {
            this._listeners[eventName].push(listener);
          }
        }
        removeEventListener(eventName, listener) {
          if (!this._listeners[eventName]) {
            return;
          }
          const index = this._listeners[eventName].indexOf(listener);
          if (index !== -1) {
            this._listeners[eventName].splice(index, 1);
          }
        }
        postMessage(message) {
          const messageString = typeof message === 'string' ? message : JSON.stringify(message);
          parent.postMessage({
            type: window.name ? 'vuplex.postMessage-' + window.name : 'vuplex.postMessage',
            message: messageString
          }, '*');
        }
        _emit(eventName, ...args) {
          if (!this._listeners[eventName]) {
            return;
          }
          for (const listener of this._listeners[eventName]) {
            try {
              listener(...args);
            } catch (error) {
              console.error('Error in ' + eventName + ' handler:', error);
            }
          }
        }
        _handleWindowMessage(event) {
          if (event.data && typeof event.data.type === 'string' && event.data.type.indexOf('vuplex.postMessage') === 0) {
            const value = event.data.message;
            const vuplexMessageEvent = new Event('vuplexmessage');
            vuplexMessageEvent.value = value;
            vuplexMessageEvent.data = value;
            window.dispatchEvent(vuplexMessageEvent);
            this._emit('message', { value, data: value });
          }
        }
      }
      // Only use the polyfill if real vuplex isn't available (WebGL cross-origin mode)
      // In native mode, the real window.vuplex will be provided by Vuplex WebView
      if (!window.vuplex) {
        console.log('[index.html] Real vuplex not found, using polyfill for WebGL cross-origin');
        window.vuplex = new VuplexPolyfill();
      } else {
        console.log('[index.html] Real vuplex found, using native Vuplex WebView');
      }
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>